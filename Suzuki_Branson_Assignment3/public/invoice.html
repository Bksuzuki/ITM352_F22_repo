<!-- Source product information -->
<link rel="stylesheet" href="./css/invoice.css">
<script src="./products.js" type="text/javascript"></script>
<script src="./functions.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">
<script>
 
    
</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        // Load functions from example assignment 3
      var products_data;
      loadJSON('get_products_data', function (response) {
          // Parsing JSON string into object
          products_data = JSON.parse(response);
      });
      var cart;
      loadJSON('get_cart', function (response) {
          // Parsing JSON string into object
          cart = JSON.parse(response);
      });
  </script>
    <h1>THE COUNTDOWN</h1>
</head>
<body>
<script>
    //IR4 and personalization recieve paramters from the URL and process name, timestamp, counter, and if first time logging in, special message for new user
    let params = (new URL(document.location)).searchParams;
        if (params.has('name')) {
            var username = params.get('name');
            document.write(`<p>Thank you for shopping with us, ${username}!<p>`);
        };
        if (params.has('time')) {
            var last_time = params.get('time');
            document.write(`<p>The last time you logged in was ${last_time}!<p>`);
        };
        if (params.has('count')) {
            var counter = params.get('count');
            document.write(`<p>You've shopped with us ${counter} times!<p>`);
        };
        if (params.has('first')){
            document.write(`<p>This is your first time shopping with us. Welcome!<p>`);
        }
        
    
</script>
<div class="page-content container">
                        <div class="cart_table">
                            <table>
                            <th>Items</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total of Product</th>
                        <script>
                            //Modified Anthony Lee's (Spring 2022) Assignment 3 in order to display cart with three different product keys
                            var subtotal = 0;

                            console.log(products_data);
                            console.log(cart)
                            
                            if (cart['Watches']){
                                for (i=0; i < cart['Watches'].length; i++){
                                    if (cart['Watches'][i]>0){
                                        price = products_data['Watches'][i]['price'];
                                        extended_price = price * parseInt(cart['Watches'][i]);
                                        subtotal += extended_price;
                                        document.write(`
                                            <tr>
                                                <input type="hidden" id="product_id" name="product_id" value=${i}>
                                                <input type="hidden" id="products_key" name="products_key" value="stickers">
                                                <td>${products_data['Watches'][i]['name']}
                                                <td>${cart['Watches'][i]}</td>
                                                <td>$${price.toFixed(2)}</td>
                                                <td>$${extended_price.toFixed(2)}</td>
                                            </tr>
                                                    `)
                                    }
                                }
                            }
                            if (cart['Glasses']){
                                for (i=0; i < cart['Glasses'].length; i++){
                                    if (cart['Glasses'][i]>0){
                                        price = products_data['Glasses'][i]['price'];
                                        extended_price = price * parseInt(cart['Glasses'][i]);
                                        subtotal += extended_price;
                                        document.write(`
                                            <tr>
                                                <input type="hidden" id="product_id" name="product_id" value=${i}>
                                                <input type="hidden" id="products_key" name="products_key" value="stickers">
                                                <td>${products_data['Glasses'][i]['name']}
                                                <td>${cart['Glasses'][i]}</td>
                                                <td>$${price.toFixed(2)}</td>
                                                <td>$${extended_price.toFixed(2)}</td>
                                            </tr>
                                                    `)
                                    }
                                }
                            }
                            if (cart['Suits']){
                                for (i=0; i < cart['Suits'].length; i++){
                                    if (cart['Suits'][i]>0){
                                        price = products_data['Suits'][i]['price'];
                                        extended_price = price * parseInt(cart['Suits'][i]);
                                        subtotal += extended_price;
                                        document.write(`
                                            <tr>
                                                <input type="hidden" id="product_id" name="product_id" value=${i}>
                                                <input type="hidden" id="products_key" name="products_key" value="stickers">
                                                <td>${products_data['Suits'][i]['name']}
                                                <td>${cart['Suits'][i]}</td>
                                                <td>$${price.toFixed(2)}</td>
                                                <td>$${extended_price.toFixed(2)}</td>
                                           </tr>
                                                    `)
                                    }
                                }
                            }
                            //computing the total prices
                         
                        </script>
                        </table>
                        </div>
                    <script> 
                        
                        </script>
                    </table>
                    </div>
                     <table class = "Shipping Policy">               
                        <tr>
                            <td>
                                <p>Shipping Policy:</p>
                                <p>FREE Shipping for orders over $2,000!</p>
                        </tr>
                    </table> 
                    <div class="Total_cost">
                   <script>
                    //Taken and modified from Blake Saari's ITM Repo from Spring 2022. But also knew concept from Making Change WOD
                        var tax = (subtotal * 0.04)
                        var shippingfee = 0;
                        // Subtotal if less than $20
                            if (subtotal < 2000){
                                shippingfee = (20);
                            // Subtotal if more than $2000
                            } 
                            else if (subtotal > 2000) {
                                shippingfee = 0;
                            }
                        // Total Calculations
                            var total = (subtotal + shippingfee + tax)
                        document.write(`
                        <div>
                            <div>
                                <div>
                                    Subtotal
                                </div>

                                <div>
                                    <span class="text-120 text-secondary-d1">$${subtotal.toFixed(2)}</span>
                                </div>
                            </div>

                            <div>
                                <div>
                                    Tax (4%)
                                </div>
                                <div class="col-5">
                                    <span class="text-110 text-secondary-d1">$${tax.toFixed(2)}</span>
                                </div>
                            </div>

                            <div>
                                <div>
                                   Shipping Fee
                                </div>
                                <div>
                                    <span class="text-110 text-secondary-d1">$${shippingfee.toFixed(2)}</span>
                                </div>
                            </div>

                            <div>
                                <div>
                                    <b>Your Total:</b>
                                </div>
                                <div>
                                    <span class="text-110 text-secondary-d1">$${total.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    `)
                    </script>
                    </div>
    <!-- Redirect to home page or to account update page -->
       <div id="thanks"><br>Thank you for your order! Your estimated shipping time is 1-3 business days. Please shop again at The Countdown! </br></div>
       <hr><a href="index.html" class="text-white-50
       fw-bold">Log Out and Go Back To Home Page</a></hr>
        <!--form to pass params to the update registration page-->
       <form name = "update" action = "./update" method="POST">
        <hr>Need to change account settings?</hr>
            <p><button type="submit" value="update" name="update">Update Information</button></p>
        </div>
    </form>
</style>
</body>
</html>